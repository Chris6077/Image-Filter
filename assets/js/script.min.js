$(document).ready(function(){AOS.init({disable:"mobile"})}),$("document").ready(function(){$("#picture").on("change",upload),$("#sub").on("click",upload),$("#r").on("click",red),$("#g").on("click",green),$("#b").on("click",blue),$("#alpha").on("click",alpha),$("#median").on("click",median)});let upload=function(){var i=new FileReader;let t=new Image;i.onload=function(){t.src=""+i.result,$("#originalcanvas")[0].getContext("2d").drawImage(t,0,0),$("#filteredcanvas")[0].getContext("2d").drawImage(t,0,0)},i.readAsDataURL($("#picture")[0].files[0])},red=function(){let t=$("#originalcanvas")[0],e=t.getContext("2d").getImageData(0,0,t.width,t.height),a=e.data;for(i=0;i<a.length;i+=4)a[i+1]=0,a[i+2]=0;e.data=a,$("#filteredcanvas")[0].getContext("2d").putImageData(e,0,0)},green=function(){let t=$("#originalcanvas")[0],e=t.getContext("2d").getImageData(0,0,t.width,t.height),a=e.data;for(i=0;i<a.length;i+=4)a[i]=0,a[i+2]=0;e.data=a,$("#filteredcanvas")[0].getContext("2d").putImageData(e,0,0)},blue=function(){let t=$("#originalcanvas")[0],e=t.getContext("2d").getImageData(0,0,t.width,t.height),a=e.data;for(i=0;i<a.length;i+=4)a[i]=0,a[i+1]=0;e.data=a,$("#filteredcanvas")[0].getContext("2d").putImageData(e,0,0)},alpha=function(){let t=$("#originalcanvas")[0],e=t.getContext("2d").getImageData(0,0,t.width,t.height),a=e.data;for(i=0;i<a.length;i+=4)a[i]=0,a[i+1]=0,a[i+2]=0;e.data=a,$("#filteredcanvas")[0].getContext("2d").putImageData(e,0,0)},median=function(){let i=new MedianFilter($("#xcount")[0].value,$("#ycount")[0].value,$("#shape")[0].value,$("#mode")[0].value),t=$("#originalcanvas")[0],e=t.getContext("2d").getImageData(0,0,t.width,t.height);$("#filteredcanvas")[0].getContext("2d").putImageData(i.convertImage(e,t.width,t.height),0,0)};function MedianFilter(i,t,e,a){this.maskHeight=t,this.maskWidth=i,this.shape=e,this.mode=a,this.kth=.5,this.NUMCLUSTERS=64,this.convertImage=function(i,t,e){var a=i.data,n=this.calculateHistograms(a),s=this.NUMCLUSTERS;n[0]=this.blurHistogram(n[0]),n[1]=this.blurHistogram(n[1]),n[2]=this.blurHistogram(n[2]);var r,h=this.equalizeHistogramSum(n[0],n[1],n[2],s),o=h[0],d=h[1],m=h[2];switch(this.shape){case this.DIAMOND:r=this.getDiamondMask(this.maskWidth,this.maskHeight);break;case this.CIRCULAR:r=this.getCircularMask(this.maskWidth,this.maskHeight);break;default:r=this.getRectangleMask(this.maskWidth,this.maskHeight)}var g=this.maskToArray(r);if(0==g.length)return i;if(this.mode==this.FAST&&this.maskWidth>3&&this.maskHeight>>3){var u=this.maskWidth>>1,c=this.maskHeight>>1;g.push([u+1,c,3])}for(u=0;u<g.length;)g[u++][0]*=4;var l=r[0].length>>1,f=g[0][1];for(u=1;u<g.length;u++)g[u][1]>f&&(f=g[u][1]);f++;var v=function(i,t,e){return o[i]+d[t]+m[e]},b=new Array(f),w=-(f>>1);for(u=1;u<f;u++)b[u]=this.getRow(a,w++,t,e,l);for(var x=v(255,255,255)+1,k=this.mode==this.FAST?new MedianHistogramFast(x):new MedianHistogram(x),y=0,p=0;p<e;p++){var I,A,M,$,C,U=this.get2D(0,2*l+1,Array);for(b.shift(),b.push(this.getRow(a,w++,t,e,l)),k.clear(),u=0,C=0;u<r.length;u++)for(c=0;c<r[u].length;c++)1==r[u][c]&&(I=c<<2,x=v(A=b[u][I++],M=b[u][I++],$=b[u][I]),U[c].push(x),k.addItem(x,A,M,$),C++);for(x=k.initMedian(C*this.kth),a[y++]=x[0],a[y++]=x[1],a[y]=x[2],y+=2,C=4;C<4*t;C+=4){for(k.removeItems(U.shift()),U.push([]),u=0;u<g.length;u++)c=C+g[u][0],A=b[I=g[u][1]][c++],M=b[I][c++],$=b[I][c],x=o[A]+d[M]+m[$],U[g[u][2]].push(x),k.addItem(x,A,M,$);k.setMedian(a,y),y+=4}}return i},this.getRow=function(i,t,e,a,n){return this.getRowRepeat(i,t,e,a,n)},this.getRowRepeat=function(i,t,e,a,n){t=t<0?0:t>=a?a-1:t;var s=i.subarray(4*e*t,4*e*(t+1)-1),r=new Uint8ClampedArray(e+2*n<<2);r.set(s,n<<2);for(var h=(d=n+0<<2)-4;h>-1;){var o=r.subarray(d,d+3);r.set(o,h),h-=4}var d;for(h=(d=4*(e+n))-4;d<r.length;){o=r.subarray(h,h+3);r.set(o,d),d+=4}return r},this.getRowReflect=function(i,t,e,a,n){t=t<0?-1-t:t>=a?2*(a-1)-t+1:t;var s=i.subarray(4*e*t,4*e*(t+1)-1),r=new Uint8ClampedArray(e+2*n<<2);r.set(s,n<<2);for(var h=(d=n+0<<2)-4;h>-1;){var o=r.subarray(d,d+3);r.set(o,h),h-=4,d+=4}var d;for(h=(d=4*(e+n))-4;d<r.length;){o=r.subarray(h,h+3);r.set(o,d),h-=4,d+=4}return r},this.get2D=function(i,t,e){for(var a=new Array(t),n=0;n<t;n++)a[n]=0==i?new e:new e(i);return a},this.calculateHistograms=function(i){for(var t=new Uint32Array(256),e=new Uint32Array(256),a=new Uint32Array(256),n=0;n<i.length;n+=22)t[i[n++]]++,e[i[n++]]++,a[i[n]]++;return[t,e,a]},this.equalizeHistogram=function(i,t){for(var e=0,a=0;a<i.length;a++)e+=i[a];for(var n=e/t,s=new Uint32Array(i.length),r=(a=0,0),h=0;a<i.length;a++){for(h+=i[a];h>n;)h-=n,r++;s[a]=r}return s},this.equalizeHistogramSum=function(i,t,e,a){for(var n=0,s=i.length,r=0;r<s;r++)n+=i[r]+t[r]+e[r];for(var h,o,d,m,g,u=n/a,c=0,l=0,f=0,v=0,b=0,w=new Uint32Array(s),x=new Uint32Array(s),k=new Uint32Array(s);l<s||f<s||v<s;)for((h=l<s?i[l]:0)<(o=f<s?t[f]:0)?(m=h,g=o):(m=o,g=h),(d=v<s?e[v]:0)<m?m=d:d>g&&(g=d),g>=.9*(h+o+d)?(w[l++]=x[f++]=k[v++]=b,c+=h+o+d):(h==m?w[l++]=b:o==m?x[f++]=b:k[v++]=b,h==g?w[l++]=b:o==g?x[f++]=b:k[v++]=b,c+=m+g);c>u;)c-=u,b++;return[w,x,k]},this.blurHistogram=function(i){var t=new Uint32Array(i.length);t[0]=t[1]=1.5*i[0];var e=i.length-1;for(t[e]=i[e-1]=1.5*i[e],e=1;e<i.length-1;e++)t[e-1]=t[e]=t[e+1]=i[e];for(e=0;e<t.length;e++)t[e]/=3;return t},this.getRectangleMask=function(i,t){for(var e=new Array(i),a=0;a<i;e[a++]=1);var n=new Array(t);for(a=0;a<t;n[a++]=e);return n},this.getCircularMask=function(i,t){var e=this.get2D(i,t,Int8Array),a=.5*(i-1),n=.5*(t-1),s=.5*(i-.5),r=.5*(t-.5);s*=s,r*=r;for(var h=0;h<t;h++)for(var o=0;o<i;o++)e[h][o]=(h-n)*(h-n)*s+(o-a)*(o-a)*r<s*r?1:0;return e},this.getDiamondMask=function(i,t){for(var e=this.get2D(i,t,Int8Array),a=.5*(i-1),n=.5*(t-1),s=.5*i*t+.01,r=0;r<t;r++)for(var h=0;h<i;h++)e[r][h]=Math.abs(r-n)*i+Math.abs(h-a)*t<=s?1:0;return e},this.maskToArray=function(i){for(var t=[],e=0,a=0;e<i.length;e++,a++)for(var n=this.countBinaries(i[e]),s=0;s<n.length-1;){var r=n[s++],h=n[s++];t.push([h-1,e,h-r-1])}return t},this.countBinaries=function(i){var t=0,e=0;for(res=[];e<i.length;){for(;i[e]==t;)e++;t=i[e],res.push(e)}return res.length<2?[]:res}}function MedianHistogram(i){this.medianbin,this.medianindex,this.histogram,this.colors,this.init=function(i){this.medianbin=0,this.medianindex=1,this.histogram=new Uint16Array(i),this.colors=[];for(var t=i;t>0;)this.colors[--t]=new Uint32Array(3)},this.init(i),this.addItem=function(i,t,e,a){i<this.medianbin&&this.medianindex--,this.histogram[i]++;var n=this.colors[i];n[0]+=t,n[1]+=e,n[2]+=a},this.removeItem=function(i){i<this.medianbin&&this.medianindex++;var t=this.colors[i];switch(this.histogram[i]){case 1:this.histogram[i]=0,t[0]=t[1]=t[2]=0;break;case 2:this.histogram[i]=1,t[0]>>=1,t[1]>>=1,t[2]>>=1;break;default:var e=this.histogram[i]--,a=this.histogram[i]/e;t[0]*=a,t[1]*=a,t[2]*=a}},this.removeItems=function(i){for(var t=0;t<i.length;)this.removeItem(i[t++])},this.initMedian=function(i){return this.medianbin=0,this.medianindex=i>>0,this.getMedian()},this.getMedian=function(){for(;this.medianindex>this.histogram[this.medianbin];)this.medianindex-=this.histogram[this.medianbin++];for(;this.medianindex<1;)this.medianindex+=this.histogram[--this.medianbin];var i=this.colors[this.medianbin];switch(this.histogram[this.medianbin]){case 1:return i;case 2:return[i[0]>>1,i[1]>>1,i[2]>>1];case 4:return[i[0]>>2,i[1]>>2,i[2]>>2];default:var t=1/this.histogram[this.medianbin];return i||alert("Invalid X/Y values. We can not filter with those values!"),[t*i[0],t*i[1],t*i[2]]}},this.setMedian=function(i,t){for(;this.medianindex>this.histogram[this.medianbin];)this.medianindex-=this.histogram[this.medianbin++];for(;this.medianindex<1;)this.medianindex+=this.histogram[--this.medianbin];var e=this.colors[this.medianbin];switch(this.histogram[this.medianbin]){case 1:i[t]=e[0],i[t+1]=e[1],i[t+2]=e[2];break;case 2:i[t]=e[0]>>1,i[t+1]=e[1]>>1,i[t+2]=e[2]>>1;break;case 4:i[t]=e[0]>>2,i[t+1]=e[1]>>2,i[t+2]=e[2]>>2;break;default:var a=1/this.histogram[this.medianbin];i[t]=a*e[0],i[t+1]=a*e[1],i[t+2]=a*e[2]}},this.clear=function(){this.init(this.histogram.length)},this.getEntries=function(){var i=[];this.entries=0;for(var t=0;t<this.histogram.length;t++)if(this.histogram[t]>0){this.entries++;for(var e=0;e<this.histogram[t];e++)i.push(t)}return this.initMedian(),i}}function MedianHistogramFast(i){this.medianbin,this.medianindex,this.colors,this.histogram,this.init=function(i){this.histogram=new Uint16Array(i),this.colors=[];for(var t=i;t;)this.colors[--t]=new Uint8ClampedArray(3);this.medianbin=0,this.medianindex=1},this.init(i),this.addItem=function(i,t,e,a){i<this.medianbin&&this.medianindex--,this.histogram[i]++;var n=this.colors[i];n[0]=t,n[1]=e,n[2]=a},this.removeItem=function(i){i<this.medianbin&&this.medianindex++,this.histogram[i]--},this.removeItems=function(i){for(var t=i.length;t;)i[--t]<this.medianbin&&this.medianindex++,this.histogram[i[t]]--},this.initMedian=function(i){return this.medianbin=0,this.medianindex=i>>0,this.getMedian()},this.getMedian=function(){for(;this.medianindex>this.histogram[this.medianbin];)this.medianindex-=this.histogram[this.medianbin++];for(;this.medianindex<1;)this.medianindex+=this.histogram[--this.medianbin];return this.colors[this.medianbin]},this.setMedian=function(i,t){for(;this.medianindex>this.histogram[this.medianbin];)this.medianindex-=this.histogram[this.medianbin++];for(;this.medianindex<1;)this.medianindex+=this.histogram[--this.medianbin];var e=this.colors[this.medianbin];i[t]=e[0],i[t+1]=e[1],i[t+2]=e[2]},this.clear=function(){this.init(this.histogram.length)},this.getEntries=function(){var i=[];this.entries=0;for(var t=0;t<this.histogram.length;t++)if(this.histogram[t]>0){this.entries++;for(var e=0;e<this.histogram[t];e++)i.push(t)}return this.initMedian(),i}}